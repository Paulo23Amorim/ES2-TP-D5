@page "/userlogin"
@using System.ComponentModel.DataAnnotations
@using Projeto_ES2.Components.Pages.DTOs
@inject HttpClient Http
@inject NavigationManager Navigation

<h3>Login</h3>

<EditForm Model="loginModel" OnValidSubmit="HandleLogin">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-2">
        <label>Email:</label>
        <InputText @bind-Value="loginModel.Email" class="form-control" />
    </div>

    <div class="mb-2">
        <label>Password:</label>
        <InputText @bind-Value="loginModel.Password" type="password" class="form-control" />
    </div>

    <button type="submit" class="btn btn-primary">Entrar</button>
</EditForm>


<p class="mt-3">Ainda não tens conta? <a href="/register">Regista-te aqui</a></p>

@code {
    private LoginModel loginModel = new()
    {
        Email = string.Empty,
        Password = string.Empty
    };


    private async Task HandleLogin()
    {
        try
        {
            var loginRequest = new LoginRequestDTO
            {
                Email = loginModel.Email,
                Password = loginModel.Password
            };

            var response = await Http.PostAsJsonAsync("https://localhost:5029/api/Auth/login", loginRequest);


            if (response.IsSuccessStatusCode)
            {
                Navigation.NavigateTo("/user");
            }
            else
            {
                Console.WriteLine("Erro no login");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Erro: {ex.Message}");
        }
    }

    public class LoginModel
    {
        [Required(ErrorMessage = "O email é obrigatório")]
        public string Email { get; set; }

        [Required(ErrorMessage = "A password é obrigatória")]
        public string Password { get; set; }
    }
}